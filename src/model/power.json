{"authorization": {"functions": [], "roles": [], "users": []}, "axes": [], "categories": [{"id": "Air", "label": {"i18n": {"en-us": "Air"}}}, {"id": "Water", "label": {"i18n": {"en-us": "Water"}}}, {"id": "Coal", "label": {"i18n": {"en-us": "Coal"}}}, {"id": "Electricity", "label": {"i18n": {"en-us": "Electricity"}}}, {"id": "Final Product", "label": {"i18n": {"en-us": "Final Product"}}}, {"id": "Pollution", "label": {"i18n": {"en-us": "Pollution"}}}, {"id": "Steam", "label": {"i18n": {"en-us": "Steam"}}}], "domains": [{"columns": [{"id": "Name", "label": {"i18n": {"en-us": "Name"}}, "note": {"i18n": {}}, "type": "STRING", "unit": {"i18n": {}}, "validation": {}}], "kind": "primary", "name": "Basic"}, {"columns": [{"category": "Water", "decimals": 2, "default_aggregation": "sum", "default_value": 0, "field_type": "input", "id": "water", "label": {"i18n": {"en-us": "Water"}}, "note": {"i18n": {"en-us": "Water consumption"}}, "resolution": "1min", "timeseries": "yes", "type": "REAL", "unit": {"i18n": {"en-us": "m3"}}, "validation": {}}, {"category": "Air", "decimals": 2, "default_aggregation": "sum", "default_value": 0, "field_type": "input", "id": "air", "label": {"i18n": {"en-us": "Air"}}, "note": {"i18n": {"en-us": "Air consumption"}}, "resolution": "1min", "timeseries": "yes", "type": "REAL", "unit": {"i18n": {"en-us": "m3"}}, "validation": {}}, {"category": "Coal", "decimals": 2, "default_aggregation": "sum", "default_value": 0, "field_type": "input", "id": "coal", "label": {"i18n": {"en-us": "Coal"}}, "note": {"i18n": {"en-us": "Coal consumption"}}, "resolution": "1min", "timeseries": "yes", "type": "REAL", "unit": {"i18n": {"en-us": "t"}}, "validation": {}}, {"category": "Electricity", "decimals": 2, "default_aggregation": "sum", "default_value": 0, "field_type": "input", "id": "electricity", "label": {"i18n": {"en-us": "Electricity"}}, "note": {"i18n": {"en-us": "Electricity consumption"}}, "resolution": "1min", "timeseries": "yes", "type": "REAL", "unit": {"i18n": {"en-us": "kWh"}}, "validation": {}}], "kind": "operational", "name": "Consumption"}, {"columns": [{"category": "Final Product", "decimals": 2, "default_aggregation": "sum", "default_value": 0, "field_type": "input", "id": "electricity", "label": {"i18n": {"en-us": "Electricity"}}, "note": {"i18n": {"en-us": "Electricity generation"}}, "resolution": "1min", "timeseries": "yes", "type": "REAL", "unit": {"i18n": {"en-us": "kWh"}}, "validation": {}}, {"category": "Pollution", "decimals": 2, "default_aggregation": "sum", "default_value": 0, "field_type": "input", "id": "co2", "label": {"i18n": {"en-us": "Carbon Dioxide"}}, "note": {"i18n": {"en-us": "Carbon Dioxide"}}, "resolution": "1min", "timeseries": "yes", "type": "REAL", "unit": {"i18n": {"en-us": "t"}}, "validation": {}}, {"category": "Steam", "decimals": 2, "default_aggregation": "sum", "default_value": 0, "field_type": "input", "id": "steam", "label": {"i18n": {}}, "note": {"i18n": {}}, "resolution": "1min", "timeseries": "yes", "type": "REAL", "unit": {"i18n": {"en-us": "t"}}, "validation": {}}], "kind": "operational", "name": "Generation"}, {"columns": [{"decimals": 1, "default_aggregation": "avg", "default_value": 0, "field_type": "direct", "id": "outside_temperature", "label": {"i18n": {"en-us": "OutsideTemperature"}}, "note": {"i18n": {}}, "resolution": "1min", "timeseries": "yes", "type": "REAL", "unit": {"i18n": {"en-us": "\u2103"}}, "validation": {}}, {"decimals": 1, "default_aggregation": "avg", "default_value": 0, "field_type": "direct", "id": "load", "label": {"i18n": {"en-us": "Load"}}, "note": {"i18n": {}}, "resolution": "1min", "timeseries": "yes", "type": "REAL", "unit": {"i18n": {"en-us": "MW"}}, "validation": {}}, {"decimals": 1, "default_aggregation": "avg", "default_value": 0, "field_type": "direct", "id": "load_prediction", "label": {"i18n": {"en-us": "LoadPrediction"}}, "note": {"i18n": {}}, "resolution": "1min", "timeseries": "yes", "type": "REAL", "unit": {"i18n": {"en-us": "MW"}}, "validation": {}}, {"decimals": 1, "default_aggregation": "avg", "default_value": 0, "field_type": "direct", "id": "steam_temperature", "label": {"i18n": {"en-us": "SteamTemperature"}}, "note": {"i18n": {}}, "resolution": "1min", "timeseries": "yes", "type": "REAL", "unit": {"i18n": {"en-us": "\u2103"}}, "validation": {}}, {"decimals": 2, "default_aggregation": "avg", "default_value": 0, "field_type": "direct", "id": "steam_pressure", "label": {"i18n": {"en-us": "SteamPressure"}}, "note": {"i18n": {}}, "resolution": "1min", "timeseries": "yes", "type": "REAL", "unit": {"i18n": {"en-us": "MPa"}}, "validation": {}}], "kind": "operational", "name": "Monitoring"}], "id": "oBViIMy6", "models": {"k39w7gy2": {"attributes": {"axis": {}, "custom_attributes": [], "icon": "/api/images/94df6f4a-3155-4827-8590-c2003b8fbeb4", "key": "boiler", "label": {"i18n": {"en-US": "Boiler", "zh-CN": "\u9505\u7089"}}, "name": "Boiler", "rollup": "yes"}, "coordinates": {"x": 0, "y": 360}, "domains": [{"columns": [{"id": "Name", "validation": {}}], "kind": "primary", "name": "Basic"}, {"columns": [{"id": "water", "validation": {}}, {"id": "air", "validation": {}}, {"id": "coal", "validation": {}}, {"id": "electricity", "validation": {}}], "kind": "operational", "name": "Consumption"}, {"columns": [{"id": "electricity", "validation": {}}, {"id": "co2", "validation": {}}, {"id": "steam", "validation": {}}], "kind": "operational", "name": "Generation"}, {"columns": [{"id": "outside_temperature", "validation": {}}, {"id": "load", "validation": {}}, {"id": "load_prediction", "validation": {}}, {"id": "steam_temperature", "validation": {}}, {"id": "steam_pressure", "validation": {}}], "kind": "operational", "name": "Monitoring"}], "id": "k39w7gy2", "instances": [{"attributes": {"operational": {}, "primary": {"Basic": [{"key": "Name", "value": "Boiler"}]}}, "key": "boiler_m1", "relations": {"relation_0": []}, "scope": "boiler_w1"}], "relations": {"in_scope_of": "k39w7j0z", "in_sub_class_of": []}, "skeleton": "from digital_machine import *\r\nfrom digital_machine.templates import templates, simple\r\n\r\nimport pandas as pd\r\nimport pickle\r\n\r\n# Load the pickled Linear Regression model (see in FILES)\r\ntry:\r\n    with open(os.path.join(os.path.dirname(__file__), \"lr.model\"), \"rb\") as f:\r\n        lr = pickle.load(f)\r\nexcept:\r\n    logging.error(\"Cannot load pickled model\", exc_info=True)\r\n\r\n# Customize the generic model template\r\nclass Boiler(simple.SimpleClassTemplate):\r\n\r\n    @templates.model()\r\n    @templates.input(features={\r\n        \"outside_temperature\": {\r\n            \"metric\": \"Monitoring.outside_temperature\",\r\n            \"aggregation\": \"1min\",\r\n            \"aggregation-function\": \"avg\"\r\n        },\r\n        \"load\": {\r\n            \"metric\": \"Monitoring.load\",\r\n            \"aggregation\": \"1min\",\r\n            \"aggregation-function\": \"avg\",\r\n        }\r\n    })\r\n    @templates.output(features={\r\n        \"load_prediction\": {\r\n            \"metric\": \"Monitoring.load_prediction\",\r\n            \"series-length\": 10,\r\n            \"resolution\": \"1min\"\r\n        }\r\n    })\r\n    def load_prediction(self, input, output):\r\n        logging.error(\"Applying model: %s\", input.data)\r\n        ts = input.timestamp - input.timestamp % 60\r\n        index = input.data[\"index\"]\r\n        d0 = index % 24\r\n        d1 = (index // 24) % 7\r\n        # Invoke prediction\r\n        result = lr.predict(\r\n            [[\r\n                input.data[\"outside_temperature\"], \r\n                d1, \r\n                d0, \r\n                input.data[\"load\"]\r\n            ]])\r\n        output.data[\"load_prediction\"] = pd.DataFrame(data={\r\n            \"load_prediction\": result[0]\r\n        }, index = [ts + (i+1)*60. for i in range(10)])\r\n        logging.error(\"Load Prediction:\\n %s\", output.data[\"load_prediction\"])\r\n        output.timestamp = ts\r\n        \r\n    C_CONTENT = 0.75\r\n    \r\n    @templates.model()\r\n    @templates.input(features={\r\n        \"coal\": {\r\n            \"metric\": \"Consumption.coal\",\r\n            \"aggregation\": \"1min\",\r\n            \"aggregation-function\": \"sum\"\r\n        }\r\n    })\r\n    @templates.output(features={\r\n        \"co2\": {\r\n            \"metric\": \"Generation.co2\",\r\n            \"aggregation\": \"1min\",\r\n            \"aggregation-function\": \"sum\"\r\n        }\r\n    })\r\n    def co2_model(self, input, output):\r\n        c = input.data[\"coal\"] * self.C_CONTENT\r\n        output.data[\"co2\"] = 44./12. * c", "template_id": "1"}, "k39w7j0z": {"attributes": {"axis": {}, "custom_attributes": [], "icon": "/api/images/c47c5610-febf-423f-9b0c-24952fb6389a", "key": "workshop", "label": {"i18n": {"en-US": "BoilerWorkshop", "zh-CN": "\u9505\u7089\u8f66\u95f4"}}, "name": "BoilerWorkshop", "rollup": "yes"}, "coordinates": {"x": 0, "y": 180}, "domains": [{"columns": [{"id": "Name", "validation": {}}], "kind": "primary", "name": "Basic"}], "id": "k39w7j0z", "instances": [{"attributes": {"operational": {}, "primary": {"Basic": [{"key": "Name", "value": "BoilerWorkshop"}]}}, "key": "boiler_w1", "relations": {"relation_0": ["boiler_m1"]}, "scope": "powerplant_p1"}], "relations": {"in_scope_of": "k39w7m0p", "in_sub_class_of": []}, "skeleton": "from digital_machine import *\nfrom digital_machine.templates import simple\nfrom digital_machine.templates import templates as t\n\nclass BoilerWorkshop(simple.SimpleClassTemplate):\n  \n  pass", "template_id": "1"}, "k39w7m0p": {"attributes": {"axis": {}, "custom_attributes": [], "icon": "/api/images/8dd0d94b-7593-47e4-84f2-adc7b923c8f9", "key": "powerplant", "label": {"i18n": {"en-US": "PowerPlant", "zh-CN": "\u7535\u5382"}}, "name": "PowerPlant", "rollup": "yes"}, "coordinates": {"x": 0, "y": 0}, "domains": [{"columns": [{"id": "Name", "validation": {}}], "kind": "primary", "name": "Basic"}], "id": "k39w7m0p", "instances": [{"attributes": {"operational": {}, "primary": {"Basic": [{"key": "Name", "value": "PowerPlant"}]}}, "key": "powerplant_p1", "relations": {"relation_0": []}}], "relations": {"in_sub_class_of": []}, "template_id": "1"}, "k3a5mamm": {"attributes": {"abstract": true, "axis": {}, "key": "powerplant", "label": {"i18n": {"en-US": "", "zh-CN": ""}}, "name": "\u7535\u5382\u62bd\u8c61"}, "coordinates": {}, "domains": [], "id": "k3a5mamm", "instances": [], "relations": {"in_sub_class_of": []}, "template_id": ""}, "k3a5n89t": {"attributes": {"abstract": true, "axis": {}, "key": "workshop", "label": {"i18n": {"en-US": "", "zh-CN": ""}}, "name": "\u8f66\u95f4\u62bd\u8c61"}, "coordinates": {}, "domains": [], "id": "k3a5n89t", "instances": [], "relations": {"in_sub_class_of": []}, "template_id": ""}, "k3a5ng42": {"attributes": {"abstract": true, "axis": {}, "key": "boiler", "label": {"i18n": {"en-US": "", "zh-CN": ""}}, "name": "\u9505\u7089\u62bd\u8c61"}, "coordinates": {}, "domains": [], "id": "k3a5ng42", "instances": [], "relations": {"in_sub_class_of": []}, "template_id": ""}}, "name": "power"}